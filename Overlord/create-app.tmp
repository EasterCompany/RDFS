#! /usr/bin/python3
import sys
from os import system as s, getcwd as _cwd
cpv = True if sys.version_info[1] >= 8 else False
try:
  cwd=_cwd()
  s("clear")
  print("\nWelcome to the Overlord Installer!\n")
  n=input("Project Name: ")
  print(f"\nCreating {n} @ {cwd} ...")
  s(f"git clone --quiet --single-branch --branch Prd --depth=1 git@github.com:EasterCompany/Overlord.git {n}")
  print(f"Success!\n")
  if not cpv:
    s(f"cd {n} && rm -rf .git")
    print(f"""
  ************************* ATTENTION *************************
  Overlord only supports Python 3.10 or greater and
  it looks like your system default at '/usr/bin/python3'
  is running on version '{sys.version_info[0]}.{sys.version_info[1]}'

  Unfortunately until this is fixed you'll need to install your
  Overlord application manually.

  You need to run this command from within your app directory:

  >> python3.10 core.py tools install

  you can replace 'python3.10' with whatever version you wish
  to use as long as it's a greater version
  *************************************************************
  """)
  else:
    print(f"Installing {n} ...")
    s(f"cd {cwd}/{n} && rm -rf .git && rm README.md")
    s(f"cd {cwd}/{n} && {sys.executable} -m pip install -r ./core/requirements.txt")
    s(f"cd {cwd}/{n} && {sys.executable} core.py tools install")
    print(f"Your project is ready @ {cwd}/{n}")
    print(f"Enter the directory using 'cd {n}' and then\nUse the './o' command to open the Overlord-CLI")
except:
  print("\n\nSorry, a fatal error was encountered.\nAborting Installation process...\n\n")
s(f"rm {__file__}")